<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Webinar Registration - The Cash Flow Academy</title>
  <meta name="description" content="Register for our free webinar on investing in the age of AI">
  <!-- Reusable Infusionsoft + WebinarFuel Form (Strict config; NO defaults) -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />
</head>
<body>

<form accept-charset="UTF-8"
      action="https://yv932.infusionsoft.com/app/form/process/0e88a9caa97c29d4c16c4bb07baa0bd2"
      class="infusion-form"
      id="inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2"
      method="POST"
      data-inf-form-id="inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2"
      data-wf-session-id="68133"
      data-wf-widget-id="78139"
      data-wf-widget-version="129684"
      data-wf-widget-name="Embed"
      data-wf-bearer-token="Dp2kG9Vucpyq5t5RVPqvDxfU"
      data-consent-id="inf_option_BycheckingthisboxIagreetoreceivetextmessagessuchasremindersupdatesandpromotionaloffersfromTheCashFlowAcademyatthemobilenumberprovidedMessageanddataratesmayapplyMessagefrequencyvariesConsentisnotaconditionofpurchaseReplySTOPtounsubscribe">

  <input name="inf_form_xid" type="hidden" value="0e88a9caa97c29d4c16c4bb07baa0bd2" />
  <input name="inf_form_name" type="hidden" value="Investing in the Age of AI&#xa;Web Form submitted - GHL&#xa;Live Reg Form" />
  <input name="infusionsoft_version" type="hidden" value="1.70.0.852640" />

  <!-- Floating field: First Name -->
  <div class="infusion-field float-field">
    <input id="inf_field_FirstName" name="inf_field_FirstName" type="text" autocomplete="given-name" />
    <label for="inf_field_FirstName">First Name</label>
  </div>

  <!-- Floating field: Last Name -->
  <div class="infusion-field float-field">
    <input id="inf_field_LastName" name="inf_field_LastName" type="text" autocomplete="family-name" />
    <label for="inf_field_LastName">Last Name</label>
  </div>

  <!-- Floating field: Email (required) -->
  <div class="infusion-field float-field">
    <input id="inf_field_Email" name="inf_field_Email" type="email" autocomplete="email" required />
    <label for="inf_field_Email">Email *</label>
  </div>

  <!-- Floating field: Mobile Phone -->
  <div class="infusion-field float-field">
    <input id="inf_field_Phone1" name="inf_field_Phone1" type="tel" autocomplete="tel" />
    <label for="inf_field_Phone1">Mobile Phone</label>
  </div>

  <!-- Consent checkbox (unchecked by default) -->
  <div class="infusion-field">
    <label class="sms-consent-row" for="inf_option_BycheckingthisboxIagreetoreceivetextmessagessuchasremindersupdatesandpromotionaloffersfromTheCashFlowAcademyatthemobilenumberprovidedMessageanddataratesmayapplyMessagefrequencyvariesConsentisnotaconditionofpurchaseReplySTOPtounsubscribe">
      <input id="inf_option_BycheckingthisboxIagreetoreceivetextmessagessuchasremindersupdatesandpromotionaloffersfromTheCashFlowAcademyatthemobilenumberprovidedMessageanddataratesmayapplyMessagefrequencyvariesConsentisnotaconditionofpurchaseReplySTOPtounsubscribe"
             name="inf_option_BycheckingthisboxIagreetoreceivetextmessagessuchasremindersupdatesandpromotionaloffersfromTheCashFlowAcademyatthemobilenumberprovidedMessageanddataratesmayapplyMessagefrequencyvariesConsentisnotaconditionofpurchaseReplySTOPtounsubscribe"
             type="checkbox" value="3872" />
      <span class="sms-consent-text">
        By checking this box, I agree to receive text messages (such as reminders, updates, and promotional offers)
        from The Cash Flow Academy at the mobile number provided. Message and data rates may apply.
        Message frequency varies. Consent is not a condition of purchase. Reply STOP to unsubscribe.
      </span>
    </label>
  </div>

  <!-- Hidden UTM + fbclid fields -->
  <input name="inf_custom_GaContent" type="hidden" value="null" />
  <input name="inf_custom_GaSource" type="hidden" value="null" />
  <input name="inf_custom_GaMedium" type="hidden" value="null" />
  <input name="inf_custom_GaTerm" type="hidden" value="null" />
  <input name="inf_custom_GaCampaign" type="hidden" value="null" />
  <input name="inf_custom_GaCampaignID" type="hidden" value="null" />
  <input name="inf_custom_GaReferurl" type="hidden" value="null" />
  <input name="inf_custom_fbclid" type="hidden" value="null" />

  <div class="infusion-submit">
    <button id="inf_submit_btn" type="submit">ðŸ”¥ Reserve My Free Seat Now</button>
  </div>
</form>

<!-- Infusionsoft Scripts -->
<script src="https://yv932.infusionsoft.app/app/webTracking/getTrackingCode" type="text/javascript"></script>
<script src="https://yv932.infusionsoft.com/app/timezone/timezoneInputJs?xid=0e88a9caa97c29d4c16c4bb07baa0bd2" type="text/javascript"></script>
<script src="https://yv932.infusionsoft.com/js/jquery/jquery-3.3.1.js" type="text/javascript"></script>
<script src="https://yv932.infusionsoft.app/app/webform/overwriteRefererJs" type="text/javascript"></script>

<!-- ===== Strict Bridge (NO defaults; blocks if misconfigured) ===== -->
<script>
/** Helpers **/
const _wf_getStoredOrURLParam = (param) => {
  try {
    const params = new URLSearchParams(window.location.search);
    let v = params.get(param);
    if (v && v !== 'null' && v.trim() !== '' && !v.startsWith('&')) return decodeURIComponent(v).trim();
    const stored = localStorage.getItem(param);
    if (stored && stored !== 'null' && stored.trim() !== '') return stored;
  } catch(e){}
  return null;
};
const _wf_persistIfPresent = (key) => {
  try {
    const params = new URLSearchParams(window.location.search);
    const val = params.get(key);
    if (val && val !== 'null' && val.trim() !== '') {
      localStorage.setItem(key, decodeURIComponent(val).trim());
    }
  } catch(e){}
  return _wf_getStoredOrURLParam(key);
};
const _wf_injectField = (name, value) => {
  const field = document.querySelector(`input[name="${name}"]`);
  if (field) {
    field.value = (value ?? '').toString();
    console.log(`[UTM] Set ${name} =`, field.value);
  }
};
const _wf_normalizePhone = (raw) => {
  const s = (raw || '').replace(/[^\d+]/g, '');
  const digits = s.replace(/\D/g, '');
  if (s.startsWith('+')) return s;
  if (digits.length === 11 && digits.startsWith('1')) return '+' + digits;
  if (digits.length === 10) return '+1' + digits;
  return s || '';
};
const _wf_fetchWithTimeout = async (url, opts = {}, timeoutMs = 4000) => {
  const controller = new AbortController();
  const id = setTimeout(() => controller.abort(), timeoutMs);
  try {
    const res = await fetch(url, { ...opts, signal: controller.signal });
    clearTimeout(id);
    return res;
  } catch (e) {
    clearTimeout(id);
    throw e;
  }
};
const _wf_showConfigError = (formEl, missingKeys) => {
  const banner = document.createElement('div');
  banner.className = 'wf-config-error';
  banner.innerHTML = `
    <strong>Configuration error:</strong> Missing required data attributes: 
    <code>${missingKeys.map(k => 'data-wf-' + k.replace('wf','').replace(/^[A-Z]/,m=>m.toLowerCase())).join(', ')}</code>.
    Please set them on the <code>&lt;form&gt;</code> before enabling submissions.
  `;
  formEl.prepend(banner);
  const btn = formEl.querySelector('#inf_submit_btn');
  if (btn) btn.disabled = true;
};

function initWFBridge(formEl) {
  if (!formEl) { console.error('[Bridge] No form element found.'); return; }

  // Read ONLY from data-* (no defaults!)
  const cfg = {
    formId: formEl.dataset.infFormId || formEl.id || '',
    wfSessionId: formEl.dataset.wfSessionId || '',
    wfWidgetId: formEl.dataset.wfWidgetId || '',
    wfWidgetVersion: formEl.dataset.wfWidgetVersion || '',
    wfWidgetName: formEl.dataset.wfWidgetName || '',
    wfBearerToken: formEl.dataset.wfBearerToken || '',
    consentId: formEl.dataset.consentId || ''
  };

  // Required keys that must be present to avoid wrong webinar
  const requiredKeys = ['wfSessionId','wfWidgetId','wfWidgetVersion','wfBearerToken'];
  const missing = requiredKeys.filter(k => !cfg[k] || String(cfg[k]).trim() === '');
  if (missing.length) {
    console.error('[Bridge] Missing required config:', { missing, cfg });
    _wf_showConfigError(formEl, missing);
    return; // Do not attach submit handler
  }

  console.log('[Init] WF/Infusionsoft bridge loaded with config:', cfg);

  // Floating label behavior
  const floatInputs = formEl.querySelectorAll('.float-field input');
  const syncFloat = (inp) => ((inp.value || '').trim() !== '' ? inp.classList.add('has-value') : inp.classList.remove('has-value'));
  floatInputs.forEach(inp => {
    syncFloat(inp);
    inp.addEventListener('focus', () => inp.classList.add('is-focus'));
    inp.addEventListener('blur', () => inp.classList.remove('is-focus'));
    inp.addEventListener('input', () => syncFloat(inp));
  });

  const consentEl = cfg.consentId ? document.getElementById(cfg.consentId) : null;
  console.log('[Consent] Checkbox found:', !!consentEl);

  // UTM persistence & injection
  _wf_injectField('inf_custom_GaSource',     _wf_persistIfPresent('utm_source'));
  _wf_injectField('inf_custom_GaMedium',     _wf_persistIfPresent('utm_medium'));
  _wf_injectField('inf_custom_GaCampaign',   _wf_persistIfPresent('utm_campaign'));
  _wf_injectField('inf_custom_GaTerm',       _wf_persistIfPresent('utm_term'));
  _wf_injectField('inf_custom_GaContent',    _wf_persistIfPresent('utm_content'));
  _wf_injectField('inf_custom_GaCampaignID', _wf_persistIfPresent('utm_id'));
  _wf_injectField('inf_custom_fbclid',       _wf_persistIfPresent('fbclid'));
  _wf_injectField('inf_custom_GaReferurl',   document.referrer || '');

  let SUBMIT_LOCK = false;
  const submitBtn = document.getElementById('inf_submit_btn');

  const handleSubmit = async (ev) => {
    ev.preventDefault();
    if (SUBMIT_LOCK) { console.log('[Submit] Blocked duplicate submit'); return; }
    SUBMIT_LOCK = true;
    if (submitBtn) { submitBtn.disabled = true; submitBtn.dataset.label = submitBtn.textContent; submitBtn.textContent = 'Submittingâ€¦'; }

    const email     = document.getElementById('inf_field_Email').value.trim();
    const firstName = document.getElementById('inf_field_FirstName').value.trim();
    const lastName  = document.getElementById('inf_field_LastName').value.trim();
    const phone     = _wf_normalizePhone(document.getElementById('inf_field_Phone1').value.trim());
    const smsConsent = !!(consentEl && consentEl.checked);

    console.log('[Form Values]', { firstName, lastName, email, phoneNormalized: phone, smsConsent });

    if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      console.warn('[Validation] Invalid or missing email');
      alert('Please enter a valid email.');
      SUBMIT_LOCK = false;
      if (submitBtn) { submitBtn.disabled = false; submitBtn.textContent = submitBtn.dataset.label || 'Submit'; }
      return;
    }

    // Strict mapping: source = URL only; utm_source = actual UTM
    const resolvedSource = window.location.href;                 // no fallback
    const utm_source     = _wf_getStoredOrURLParam('utm_source') || "";

    console.log('[Source Mapping]', { source: resolvedSource, utm_source });

    const payload = {
      version_id: cfg.wfWidgetVersion,
      recaptcha_action: "wf_verify_recaptcha",
      viewer: {
        webinar_session_id: cfg.wfSessionId,
        time_zone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        email,
        first_name: firstName,
        last_name:  lastName,
        phone: smsConsent ? phone : "",
        lead: false,
        registration_source_widget_type: "embed",
        registration_source_widget_name: cfg.wfWidgetName || "embed",
        widget_id: cfg.wfWidgetId,
        widget_version_id: cfg.wfWidgetVersion,
        source:      resolvedSource,
        utm_source:  utm_source,
        utm_medium:  _wf_getStoredOrURLParam('utm_medium')   || "",
        utm_campaign:_wf_getStoredOrURLParam('utm_campaign') || "",
        utm_term:    _wf_getStoredOrURLParam('utm_term')     || "",
        utm_content: _wf_getStoredOrURLParam('utm_content')  || ""
      }
    };

    console.log('[WebinarFuel] Payload:', payload);

    try {
      const res = await _wf_fetchWithTimeout("https://embed.webby.app/embed/v2/viewers", {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + cfg.wfBearerToken
        },
        body: JSON.stringify(payload)
      }, 4000);
      const data = await res.json().catch(() => ({}));
      if (data?.cid) { try { localStorage.setItem('_wf_cid', data.cid); } catch(e) {} }
      console.log('[WebinarFuel] Response:', data);
    } catch (err) {
      console.error('[WebinarFuel] Send failed (continuing):', err);
    }

    console.log('[Infusionsoft] Submitting form nowâ€¦');
    (document.getElementById(cfg.formId) || formEl).submit();
  };

  formEl.addEventListener('submit', handleSubmit);
}

document.addEventListener('DOMContentLoaded', () => {
  // Require a form that actually has WF data-* attributes
  const formEl = document.querySelector('form.infusion-form[data-wf-session-id][data-wf-widget-id][data-wf-widget-version][data-wf-bearer-token]');
  if (!formEl) {
    console.error('[Bridge] No configured form found.');
    const fallback = document.querySelector('form.infusion-form');
    if (fallback) _wf_showConfigError(fallback, ['wfSessionId','wfWidgetId','wfWidgetVersion','wfBearerToken']);
    return;
  }
  initWFBridge(formEl);
});
</script>

<style>
  /* Scoped to this form */
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 {
    max-width:560px; margin:0 auto;
    font-family:'Montserrat',sans-serif !important;
    text-align:left !important;
  }
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 .infusion-field { margin-bottom:16px; text-align:left !important; }

  /* Config error banner */
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 .wf-config-error {
    background:#FFF5F5; border:1px solid #F5C2C7; color:#842029;
    padding:10px 12px; border-radius:8px; margin-bottom:14px;
    font-size:14px;
  }
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 .wf-config-error code {
    background:#ffe3e3; padding:2px 6px; border-radius:6px;
  }

  /* Floating labels */
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 .float-field { position:relative; }
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 .float-field input {
    width:100%; padding:14px 12px 12px; border:1px solid #cfd4dc; border-radius:10px;
    font-size:16px; background:#fff; outline:none; transition:border-color .15s ease;
    position:relative; z-index:1; font-family:'Montserrat',sans-serif !important;
  }
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 .float-field input:focus { border-color:#F28C28; }
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 .float-field label {
    position:absolute; left:12px; top:50%; transform:translateY(-50%);
    background:#fff; padding:0 6px; color:#4b5563 !important; font-size:15px !important;
    font-family:'Montserrat',sans-serif !important; line-height:1; pointer-events:none;
    transition:all .15s ease; z-index:2; display:block !important; opacity:1 !important;
  }
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 .float-field input:focus + label,
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 .float-field input.has-value + label {
    top:-8px; transform:none; font-size:12px !important; color:#F28C28 !important;
  }

  /* Consent row (left aligned) */
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 .sms-consent-row { 
    display:flex; align-items:flex-start; gap:10px; cursor:pointer; 
    font-family:'Montserrat',sans-serif !important; text-align:left !important;
  }
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 .sms-consent-row input[type="checkbox"] { width:16px; height:16px; margin-top:2px; }
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 .sms-consent-text { font-size:13px; line-height:1.35; color:#333; }

  /* Orange CTA button */
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 .infusion-submit button {
    width:100%; padding:12px 16px; border:none; border-radius:10px; background:#F28C28; color:#fff;
    font-size:17px; font-weight:700; font-family:'Montserrat',sans-serif !important;
    cursor:pointer; transition:background-color .2s ease, transform .1s ease;
  }
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 .infusion-submit button:hover:not(:disabled) { background:#e67c1f; transform:translateY(-1px); }
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 .infusion-submit button:disabled { opacity:.7; cursor:not-allowed; }

  /* Errors (optional) */
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 .input-error { border-color:#CF252D !important; }
  #inf_form_0e88a9caa97c29d4c16c4bb07baa0bd2 .error-message { color:#CF252D; font-size:12px; margin-top:6px; }
</style>

</body>
</html>